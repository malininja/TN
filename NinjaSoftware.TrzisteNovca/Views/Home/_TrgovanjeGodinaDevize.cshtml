@model IEnumerable<NinjaSoftware.TrzisteNovca.CoolJ.DatabaseGeneric.BusinessLogic.TrgovanjeMjesec>
@using NinjaSoftware.TrzisteNovca.CoolJ.DatabaseGeneric.BusinessLogic
@using NinjaSoftware.TrzisteNovca.Models

@{
    IEnumerable<ValutaEnum> valutaCollection = Model.Where(tm => tm.Valuta != ValutaEnum.Kn).Select(tm => tm.Valuta).Distinct();    
}

<table>
    <tr>
        <th colspan="5">
            @string.Format("Pozajmice deviza u {0}. godini", Request.Params["godina"])
        </th>
    </tr>
    <tr>
        <th>
            Mjesec
        </th>
        <th>
            Valuta
        </th>
        <th>
            Promet
        </th>
        <th>
            Kamatna stopa (%)
        </th>
        <th>valuta</th>
    </tr>

@foreach (ValutaEnum valuta in valutaCollection)
{
    <tr>
        <td colspan="5">@valuta.ToString()</td>
    </tr>
    foreach (TrgovanjeMjesec trgovanjeMjesec in Model.Where(tm => tm.Valuta == valuta))
    {
        <tr>
            @{
                string potraznja = trgovanjeMjesec.Potraznja.HasValue ? trgovanjeMjesec.Potraznja.Value.ToStringInMilions() : "-";
                string ponuda = trgovanjeMjesec.Ponuda.HasValue ? trgovanjeMjesec.Ponuda.Value.ToStringInMilions() : "-";
                string promet = trgovanjeMjesec.Promet.HasValue ? trgovanjeMjesec.Promet.Value.ToStringInMilions() : "-";
                string kamatnaStopa = trgovanjeMjesec.KamatnaStopa.HasValue ? trgovanjeMjesec.KamatnaStopa.Value.ToString("N2") : "-";
            }
            <td>
                @Html.ActionLink(trgovanjeMjesec.Mjesec.ToString(), "TrgovanjeMjesec", 
                    new { godina = trgovanjeMjesec.Godina, mjesec = trgovanjeMjesec.Mjesec, valutaEnum = trgovanjeMjesec.Valuta })
            </td>
            <td>
                @valuta.ToString()
            </td>
            <td>
                @promet
            </td>
            <td>
                @kamatnaStopa
            </td>
            <td>@trgovanjeMjesec.Valuta.ToString()</td>
        </tr>
    }
}
</table>